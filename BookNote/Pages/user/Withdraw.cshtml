@page
@model BookNote.Pages.user.WithdrawModel
@{
    ViewData["Title"] = "退会";
}
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BookNote - @ViewData["Title"]</title>
    <link type="text/css" rel="stylesheet" href="~/css/site.css">
    <link type="text/css" rel="stylesheet" href="~/css/mypage.css">
    <link type="text/css" rel="stylesheet" href="~/css/privacy.css">
    <link type="text/css" rel="stylesheet" href="~/css/withdraw.css">
</head>
<body class="mypage-page">
    <div class="main-content">
        <div class="page-header-row">
            <a href="/user/MyPage" class="btn-back">← マイページへ戻る</a>
            <h1 class="page-title">退会</h1>
        </div>

        @if (!string.IsNullOrEmpty(Model.ErrorMessage)) {
            <div class="alert alert-error">@Model.ErrorMessage</div>
        }

        <div class="withdraw-card">
            <div class="withdraw-warning-icon">⚠️</div>
            <h2 class="withdraw-title">本当に退会しますか？</h2>
            <p class="withdraw-desc">退会すると、以下のデータがすべて削除され、<strong>復元できません。</strong></p>

            <ul class="withdraw-list">
                <li>プロフィール情報・アイコン画像</li>
                <li>投稿したすべてのレビュー</li>
                <li>いいね・フォロー・ブロックの情報</li>
                <li>ミュート設定</li>
            </ul>

            <div class="withdraw-confirm-area">
                <form method="post" id="withdrawForm">
                    @Html.AntiForgeryToken()
                    <div class="withdraw-btn-row">
                        <a href="/user/MyPage" class="btn-secondary">キャンセル</a>
                        <button type="button"
                                class="btn-withdraw"
                                onclick="confirmWithdraw()">退会する</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 確認ダイアログ -->
    <div id="withdrawConfirmOverlay" class="withdraw-overlay" style="display:none;">
        <div class="withdraw-dialog">
            <p class="withdraw-dialog-text">本当に退会します。この操作は取り消せません。<br>よろしいですか？</p>
            <div class="withdraw-dialog-btns">
                <button type="button" class="btn-secondary" onclick="closeConfirm()">いいえ</button>
                <button type="button" class="btn-withdraw" id="withdrawFinalBtn" onclick="submitWithdraw()">はい、退会します</button>
            </div>
        </div>
    </div>

    <script type="text/javascript" src="~/js/site.js"></script>
    <script>
        function confirmWithdraw() {
            document.getElementById('withdrawConfirmOverlay').style.display = 'flex';
        }

        function closeConfirm() {
            document.getElementById('withdrawConfirmOverlay').style.display = 'none';
        }

        function submitWithdraw() {
            const btn = document.getElementById('withdrawFinalBtn');
            btn.disabled = true;
            btn.textContent = '処理中...';
            document.getElementById('withdrawForm').submit();
        }

        // オーバーレイ外クリックで閉じる
        document.getElementById('withdrawConfirmOverlay').addEventListener('click', function (e) {
            if (e.target === this) closeConfirm();
        });
    </script>
</body>
</html>
